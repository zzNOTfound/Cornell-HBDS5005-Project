---
title: "BioStat I Final Project"
author: "Jiefei Hu, Minhee Kwon, Yaoting Li, Xueqing Zhou"
date: "2022-12-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  cache = TRUE,
  error = FALSE,
  message = FALSE,
  warning = FALSE,
  tidy.opts = list(width.cutoff = 60)
)
```

```{r load_packages}
library(tidyverse)
library(gtsummary)
```

```{r load_data}
load("./brfss2013.RData")
dim(brfss2013)
head(brfss2013)
```

```{r data_clean}
# drop duplication
brfss_unique <- brfss2013[!duplicated(brfss2013$seqno), ]

# drop blank/refused/unknown/not sure
brfss_tmp <- brfss_unique %>%
  select(X_state, genhlth, sex, income2, weight2, height3, sleptim1, fruit1, fruitju1, avedrnk2) %>%
  na.omit() %>%
  filter(X_state == "Alabama") %>%
  filter(!(genhlth == 7) & !(genhlth == 9)) %>%
  filter(!(income2 == 77) & !(income2 == 99)) %>%
  filter(!(weight2 == 7777) & !(weight2 == 9999) & !(weight2 == '')) %>%
  filter(!(height3 == 7777) & !(height3 == 9999)) %>%
  filter(sleptim1 >= 1 & sleptim1 <= 24) %>%
  tibble()

# unify height unit in meters
tmp_height <- c()
for (i in brfss_tmp$height3) {
  if (as.numeric(i) <= 711) {
    tmp_height <- append(tmp_height, (as.numeric(substr(i, 1, 1))*30.48 + as.numeric(substr(i, 2, 3))*2.54)/100)
  } else {
    tmp_height <- append(tmp_height, as.numeric(substr(i, 2, 4))/100)
  }}
brfss_tmp$height_new <- tmp_height

# unify weight units in kilograms
tmp_weight <- c()
for (i in brfss_tmp$weight2) {
  if (as.numeric(i) <= 999) {
    tmp_weight <- append(tmp_weight, as.numeric(i)*0.4536)
  } else {
    tmp_weight <- append(tmp_weight, as.numeric(substr(i, 2, 4)))
  }}
brfss_tmp$weight_new <- tmp_weight

# create new 'BMI' variable
brfss_tmp %>% 
  mutate(BMI = weight_new/height_new^2) %>%
  select(genhlth, sex, income2, BMI, sleptim1, fruit1, fruitju1, avedrnk2) -> brfss
```

## What is the outcome variable of interest in your analysis? 

Our outcome variable of interest is General Health 'genhlth'.

```{r outcome_variable_distribution}
plot(brfss$genhlth,
     main = "Distribution of General Health",
     xlab = "General Health")
```

##	What are the descriptive characteristics of your specified cohort?

### Distribution

```{r genhlth~sex}
barplot(table(brfss$sex, brfss$genhlth),
        main = "Distribution of General Health by Sex", xlab = "General Health",
        legend = rownames(table(brfss$sex, brfss$genhlth)), beside = TRUE)
```
```{r genhlth~income}
barplot(table(brfss$income2, brfss$genhlth),
        main = "Distribution of General Health by Income Level", xlab = "General Health",
        legend = rownames(table(brfss$income2, brfss$genhlth)), beside = TRUE)
```

```{r genhlth~BMI}
brfss %>%
  ggplot(aes(x = genhlth, y = BMI, fill = genhlth)) +
  geom_boxplot() + theme_classic() +
  labs(title = "Boxplot of General Health by BMI",
       x = "General Health", y = "BMI")
```

Table One is used to show numerical summaries of characteristics/variables of interest by the categorical variable General Health 'genhlth'. 

More specifically, it shows number of count and percentage for all categorical variables, and it presents median and IQR for all continuous variables.

```{r table_one}
data3 <- df %>%
  select(genhlth, avedrnk2, sex) %>%
  drop_na() %>%
  filter(avedrnk2<77)%>%
  group_by(genhlth) %>%
  summarize(avg_drink = mean(avedrnk2))


tbl_summary(brfss, by = genhlth,
            label = list(sex ~ "Sex",
                         income2 ~ "Income Level",
                         BMI ~ "BMI",
                         sleptim1 ~ "Sleep Hours",
                         fruit1 ~ "Times Eating Fruit",
                         fruitju1 ~ "Times Drinking Fruit Juices"),
            statistic = list(all_continuous() ~ "{median}, ({p25}, {p75})",
                             all_categorical() ~ "{n} ({p}%)")) %>%
  add_p(test = list(all_continuous() ~ "t.test")) %>%
  modify_header(label = "**Characteristics**") %>%
  bold_labels()
```

## sociodemographic variables

## Research Question 1
Is there an association between alcohol consumption and level of general health?
-  How does it apply to across income level, genders,etc?

```{r}
# version1

brfss_alcohol <- brfss_unique %>%
  select(genhlth, avedrnk2, sex) %>%
  drop_na() %>%
  filter(avedrnk2<77)%>%
  group_by(genhlth) %>%
  summarize(avg_drink = mean(avedrnk2))

ggplot(brfss_alcohol, aes(x= genhlth, y = avedrnk2)) + geom_point(aes(x= genhlth, y = avg_drink)) + labs(x = "general health", y = "average drink", title = "general health vs average drink") 

# version 2
brfss_tmp_alcohol <- brfss %>%
  select(genhlth, sex, income2 ,avedrnk2) %>%
  na.omit() %>%
  filter(avedrnk2<77) %>%
  group_by(genhlth) %>%
  summarize(avg_drink = mean(avedrnk2)) %>%
  tibble()

ggplot(brfss_tmp_alcohol, aes(x= genhlth, y = avedrnk2)) + geom_point(aes(x= genhlth, y = avg_drink)) + labs(x = "general health", y = "average drink", title = "general health vs average drink") 

## question here: if I use brfss_unique data and brfss data, the mean is different
## it more make sense if I use brfss_alcohol data when you see the plot.
## Would it be okay to use different data variables for each question? or should we make the primary data more general? 
```
```{r}
## table of alcohol consumption, gender, general thelah
brfss_alcohol_sex <- brfss_unique %>%
  select(genhlth, avedrnk2, sex) %>%
  drop_na() %>%
  filter(avedrnk2<77)%>%
  group_by(genhlth, sex) %>%
  summarize(avg_drink = mean(avedrnk2))
brfss_alcohol_sex
```

```{r}
## table of alcohol consumption, gender, general thelah
ggplot(brfss_alcohol_sex, aes(x = genhlth, y = avg_drink, fill = sex)) +
         geom_bar(position = "dodge", stat = "identity") +
         labs(x = "General Health Status", y = "Daily Alcohol Consumption", fill = "Gender", title = "Relationship between genhealth and alcohol consumption") 
```
## Explanation: The plot shows that people in poor health drinks more alcohol than those people in good health. When comparing between genders, male consumes more alcohol than women.
